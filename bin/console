#!/usr/bin/php
<?php
/**
 * Console entry point
 *
 * @author    Ivanis KouamÃ© <ivanis.kouame@smile.fr>
 * @copyright 2015 Smile
 */
const ROOT_PATH = __DIR__;

require_once __DIR__ . '/../app/bootstrap.php';

use Doctrine\ORM\Tools\Console\ConsoleRunner as ORMConsoleRunner;
use Hipay\SilexIntegration\Command\Vendor\ProcessCommand as VendorProcessCommand;
use Hipay\SilexIntegration\Command\Cashout\ProcessCommand as CashoutProcessCommand;
use Hipay\SilexIntegration\Command\Cashout\GenerateCommand as CashoutGenerateCommand;
use Hipay\SilexIntegration\Command\Vendor\RecordCommand;
use Symfony\Component\Console\Application;

$console = new Application("Hipay Mirakl Connector Console");

$console->setHelperSet($helperSet);

$console->setCatchExceptions(true);

$console->setDispatcher($eventDispatcher);

ORMConsoleRunner::addCommands($console);

$vendorProcessCommand = new VendorProcessCommand($logger, $vendorProcessor);
$vendorProcessCommand->setZipPath($parameters['default.zip.path']);
$vendorProcessCommand->setFtpPath($parameters['default.ftp.path']);

$cashoutGenerateCommand = new CashoutGenerateCommand(
    $logger,
    $cashoutInitializer,
    $parameters['cycle.days'],
    $parameters['cycle.hour'],
    $parameters['cycle.minute'],
    $parameters['cycle.interval.before'],
    $parameters['cycle.interval.after']
);

$cashoutProcessCommand = new CashoutProcessCommand(
    $logger,
    $cashoutProcessor,
    $parameters['label.public'],
    $parameters['label.private'],
    $parameters['label.withdraw']
);

$vendorRecordCommand = new RecordCommand($logger, $vendorProcessor);

$commands = array(
    $vendorProcessCommand,
    $vendorRecordCommand,
    $cashoutProcessCommand,
    $cashoutGenerateCommand
);

$console->addCommands($commands);

$console->run();
